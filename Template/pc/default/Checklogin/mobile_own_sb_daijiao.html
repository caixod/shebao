<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
    <title>社保办理</title>
    <link rel="stylesheet" href="__STATIC__/css/mobile_css/reset.css">
    <link rel="stylesheet" href="__STATIC__/css/mobile_css/bootstrap.min.css">
    <link rel="stylesheet" href="__STATIC__/css/mobile_css/mpicker.css">
    <link rel="stylesheet" href="__STATIC__/css/mobile_css/common.css">
    <link rel="stylesheet" href="__STATIC__/css/mobile_css/style.css">
    <script src="__STATIC__/js/mobile_js/jquery.min.js"></script>
    <script src="__STATIC__/js/mobile_js/bootstrap.min.js"></script>
    <script src="__STATIC__/js/other.js"></script>
    <script src="__STATIC__/js/global_no.js"></script>
    <script src="__STATIC__/js/new_js/laydate/laydate.js"></script>
    <script src="__STATIC__/js/new_js/layer/layer.js"></script>
</head>
<body>
    <div class="container">
        <div class="row top text-center no_margin">
            <div class="col-xs-3">
                <img class="logo" src="http://www.zhongguoshebaodaili.cn/Public/Home/images/about_02.gif" width="100%   " alt="">
            </div>
            <div class="row no_margin col-xs-6 _title">

            </div>
            <div class="col-xs-3 _title">
                <a href="{:U('Home/Checklogin/login')}">个人登录</a>
                <!--<a href="{:U('Home/Checklogin/company_login')}">企业登录</a>-->
                <a href="{:U('Home/Checklogin/register')}">注册</a>
            </div>
        </div>
    </div>
    <div class="s_title">社保公积金自助下单</div>
    <div class="s_city">参保城市</div>

    <form action="" method="post" onsubmit="return false;" id="form1">

    <div class="slide_out">
        <div class="slide1">请选择：</div>
        <div class="slide-wapper">
        <div class="slide-item">
            <select class="dqxl" name="to_province" id="to_province" onChange="get_city_t(this);">
                <option  value="0">请选择</option>
                <volist name="province" id="p">
                    <option  value="{$p.id}">{$p.name}</option>
                </volist>
            </select>
            <select class="dqxl" name="to_city" id="to_city" onchange="to_shebao_jishu();" >
                <option  value="0">请选择</option>
            </select>
        </div>
    </div>
    </div>
    <div class="s_city">参保人员</div>
    <div class="slide_out">
        <ul class="slide_out_ul">
            <li>
                <ul class="user" style="">
                    <li  class="li">姓名</li>
                    <li class="li">社保基数</li>
                    <li class="li">公积金基数</li>
                </ul>
            </li>
            <foreach name="friend" item="vo" key="k" >
            <li>
                <ul class="user">
                    <li class="li">{$vo.username}</li>
                    <li class="li">
                        <input type="text" class="g_sbjs" name="shebao_jishu[{$vo.user_id}]" placeholder="" value="" user_id="{$vo.user_id}">
                    </li>
                    <li class="li">
                        <input type="text" class="g_gjjjs"  name="gjj_jishu[{$vo.user_id}]" placeholder="" value="" user_id="{$vo.user_id}">
                    </li>
                    <li class="close">×</li>
                </ul>
            </li>
            </foreach>

        </ul>
    </div>

    <div class="s_city">参保月份</div>
    <div class="_date">
        <span>社保：</span>
        <input  id="date1" name="shebao_start_time" value="" />
        <input id="date2" name="shebao_end_time" value=""/>
        <button class="b_on" id="is_shebao">办理</button>
    </div>
    <div class="_date">
        <span>公积金：</span>
        <input  id="date3" name="gjj_start_time" value=""/>
        <input id="date4" name="gjj_end_time" value=""/>
        <button  class="b_on" id="is_gjj">办理</button>
    </div>
    <div style="width:50%;margin: 2px auto;" id="add_input">
        <button type="button" class="btn btn-primary btn-sm btn-block" onclick="check_field();">提交订单</button>

    </div>

        </form>

    <!--<div class="s_city">相关费用</div>-->
    <div class="tip" style="padding-left:15px;">
        <!--<p>-->
            <!--社保：<span><i class="tip-s-total"></i>3300元</span>-->
            <!--公积金：<span><i class="tip-r-total"></i>3400元</span>-->
            <!--服务费：<span><i class="t-ser-fee"></i>1200元</span>-->
        <!--</p>-->
        <!--<p>-->
            <!--参保月数：<span><i class="t-s-month"></i>6个月</span>-->
            <!--参保人数：<span><i class="t-s-person"></i>2个人</span>-->
        <!--</p>-->
        <!--<p>-->
            <!--费用总计：<span><b class="tip-allTotal"></b>7900元</span>-->
        <!--</p>-->
    </div>

    <div id="datePlugin"></div>
    <div class="ft-footer">
        <div class="ft-footer-nav">
            <div class="ft-footer-nav-l fl">
                <ul class="about-us">
                    <li><a href="#">关于我们</a></li>
                    <li><a href="#">联系我们</a></li>
                    <li><a href="#">新浪微博</a></li>
                    <li><a href="#">加入我们</a></li>
                </ul>
                <div class="_url">
                    <div >
                        <a href="http://www.mohrss.gov.cn/">中华人民共和国人力资源和社会保障部</a>
                        <a href="http://www.spicezee.com/">中国社保网</a>
                        <a href="http://www.bjrbj.gov.cn/">北京市人力资源和社会保障局</a>
                        <a href="http://www.szsi.gov.cn/">深圳市社会保险基金管理局</a>
                        <a href="http://www.12333sh.gov.cn/index.shtml">上海市人力资源和社会保障局</a>
                    </div>
                    <p class="ads">版权所有(C)2018-2020慧智博思&nbsp;</p>
                </div>
            </div>
        </div>
    </div>
</body>
<script src="__STATIC__/js/mobile_js/json.js"></script>
<script src="__STATIC__/js/mobile_js/jsonExchange.js"></script>
<script src="__STATIC__/js/mobile_js/mPicker.min.js"></script>
<script src="__STATIC__/js/mobile_js/date.js"></script>
<script src="__STATIC__/js/mobile_js/iscroll.js"></script>
<script>
    //计算社保。公积金基数
    function to_shebao_jishu(){
        var city=$("#to_city").val();
        if(city>0){
            $.ajax({
                url:"{:U('Checklogin/get_jishu')}",
                type:'post',
                data:{'city':city},
                dataType:'json',
                success:function(e){
                    if(e.code==1){

                        $(".g_sbjs").attr('placeholder', e.data.sb_min+'元~元'+e.data.sb_max);//社保
                        $(".g_gjjjs").attr('placeholder', e.data.gjj_minbase+'元~元'+e.data.gjj_maxbase);//公积金
                    }else{
                        layer.alert(e.mess, {icon: 2});
                    }
                },
                error:function(e){
                    layer.alert("服务器内部错误", {icon: 2});
                }
            })
        }else{
            layer.alert("请选择办理城市", {icon: 2});
        }

    }
    //点击去支付，提交表单，验证字段
    function check_field(){

        var is_shebao=false;//是否缴纳社保
        var is_gjj=false;//是否缴纳公积金
        if($("#is_shebao").text()=="办理"){
           is_shebao=true;
        }
        if($("#is_gjj").text()=="办理"){
            is_gjj=true;
        }

        var city=$("#to_city").val();
        var date1=$("#date1").val();
        var date2=$("#date2").val();
        var date3=$("#date3").val();
        var date4=$("#date4").val();


        if(city==0){
            layer.alert("请选择要办理社保的城市", {icon: 2});
            $("html,body").animate({scrollTop:0},500);//返回顶部
            return false;
        }

        var is_null=0;
        var shebao_user_id='';
        var gjj_user_id='';
        var shebao_base_str='';
        var gjj_base_str='';
        //循环查看社保有没有都填写完
        $(".g_sbjs").each(function(i){
            if(!$(this).val()){
                is_null=1;
            }else{
                var user_id=$(this).attr("user_id");
                var shebao_base=$(this).val();
                // alert(shebao_base);
                shebao_user_id+=user_id+"-";
                shebao_base_str+=shebao_base+"-";
            }
        });
        $(".g_gjjjs").each(function(i){
            if(!$(this).val()){
                is_null=1;
            }else{
                var user_id=$(this).attr("user_id");
                var gjj_base=$(this).val();
                gjj_user_id+=user_id+"-";
                gjj_base_str+=gjj_base+"-";
            }
        });
        if(is_null){
            layer.alert("请填写办理基数", {icon: 2});
            $("html,body").animate({scrollTop:0},500);//返回顶部
            return false;
        }
        //如果缴纳社保。时间必须填写
        if(is_shebao && (date1>=date2)){
            layer.alert("请选择正确的社保办理日期", {icon: 2});
            $("html,body").animate({scrollTop:0},500);//返回顶部
            return false;
        }
        //如果缴纳社保。时间必须填写
        if(is_gjj && (date3>=date4)){
            layer.alert("请选择正确的公积金办理日期", {icon: 2});
            $("html,body").animate({scrollTop:0},500);//返回顶部
            return false;
        }


        //
        if(gjj_user_id || shebao_user_id){
            $.ajax({
                url:"{:U('Checklogin/calculate')}",
                type:'post',
                data:{'shebao_user_id':shebao_user_id,'date1':date1,'date2':date2,'date3':date3,'date4':date4,'is_shebao':is_shebao,'is_gjj':is_gjj,'city':city,'shebao_base_str':shebao_base_str,'gjj_base_str':gjj_base_str,'is_bujiao':0,'is_mobile':1},
                 dataType:"json",
                success:function(data){

                    if(data.code==1){
                        var indexs=layer.confirm('订单费用详情:<br>社保费：'+data.sb_fee+" 元<br>公积金费："+data.gjj_fee+" 元<br>服务费："+data.service_fee+" 元<br> 总费用："+data.all_total+" 元", {
                            btn: ['确认','取消'] //按钮
                        }, function(indexs){
                            $("#add_input").append("<input type='hidden' name='is_shebao' value='"+is_shebao+"'>");
                            $("#add_input").append("<input type='hidden' name='is_gjj' value='"+is_gjj+"'>");
                            layer.close(indexs);
                            $("#form1").submit();
                            // return true;
                        }, function(indexs){
                            layer.close(indexs);
                        });
                    }

                },
                error:function(e){
                    layer.alert("服务器内部错误", {icon: 2});
                    return false;
                }

            })
        }
        return false;
    }



    $(function() {
        $('.select-value').mPicker({
            level:2,
            dataJson: city3,
            Linkage:true,
            rows:6,
            idDefault:true,
            splitStr:'-',
            header:'<div class="mPicker-header">请选择参保城市</div>',
            confirm:function(json){
                console.info('当前选中json：',json);
                console.info('【json里有不带value时】');
                console.info('选中的id序号为：', json.ids);
                console.info('选中的value为：', json.values);
            },
            cancel:function(json){
                console.info('当前选中json：',json);
            }
        })
    });
    $(".close").on("click",function() {
        $(this).parent().parent().remove();
    })
    $(function(){

        $("#btn2").click(function(){

            $("#show2").modal("show");
        });
        $(".g_quxiao").click(function(){
            $("#show2").modal("hide");
        })
        $(".g_close").click(function() {
            $("#show2").modal("hide");
        });
        // $(".b_on").on("click",function() {
        //     $(".b_on").removeClass("b_on2");
        //     $(this).addClass("b_on2");
        //     $(this).text("不办");
        //     $(this).siblings().filter("input").attr("disabled","true");
        // });
        $(".b_on").on("click",function() {
            if($(this).hasClass("b_on2")){
                $(this).removeClass("b_on2");
            }else{
                $(this).addClass("b_on2");
            }
            if($(this).text()=="不办"){
                $(this).text("办理")
                $(this).siblings().filter("input").removeAttr("disabled");
            }else{
                $(this).text("不办");
                $(this).siblings().filter("input").attr("disabled","true");
            }
            
        });
    })

    //执行一个laydate实例
    //执行一个laydate实例
    laydate.render({
        elem: '#date1' //指定元素
        ,type: 'month'
        ,min: 0
        ,max: 2000
    });
    laydate.render({
        elem: '#date2' //指定元素
        ,type: 'month'
        ,min: 0
        ,max: 2000
    });
    laydate.render({
        elem: '#date3' //指定元素
        ,type: 'month'
        ,min: 0
        ,max: 2000
    });
    laydate.render({
        elem: '#date4' //指定元素
        ,type: 'month'
        ,min: 0
        ,max: 2000
    });
</script>
</html>